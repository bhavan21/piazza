{% load static %}
<html>
<head>
	<title>Home | ForDis</title>
	<link rel="stylesheet" href="{% static 'class/materialize.min.css' %}">
	<link rel="stylesheet" href="{% static 'class/iconFamilyMaterialIcons.css' %}">
	<script type="text/javascript" src="{% static 'class/jquery-3.2.1.min.js' %}"></script>
	<script src="{% static 'class/materialize.min.js' %}"></script>

    <script src="{% static 'class/jquery.webui-popover.min.js' %}"></script>
	<link rel="stylesheet" href="{% static 'class/jquery.webui-popover.min.css' %}">
	<script >
		$(document).ready(function() {
			$('#modal_join').modal();
			$('#modal_create').modal();
			$('#select_semester').material_select();
			$( "#datepicker" ).material_select();
			$('#join_button').click(function(){
				// alert("desp");
				
				$.ajax({
				    url: 'join_form',
				    type: 'post',
					data: $('#join_form').serialize(),
					success: function(data) {

						if(data == "Failed")
				          Materialize.toast("Invalid Class Credentials", 4000);
				        if(data == "instructor")
				        	Materialize.toast("You're Instructor For it. Can't Do",4000);
				        if(data == "already")
				        	Materialize.toast("Already Enrolled",4000);
				        if(data == "success")
				        {
				        	Materialize.toast("Success",4000);
				        	location.reload();
				        }


				         }
				});

			});

			$('#create_button').click(function(){

				$.ajax({
				    url: 'create_form',
				    type: 'post',
					data: $('#create_form').serialize(),
					success: function(data) {

				        if(data == "success")
				        {
				        	Materialize.toast("Success",4000);
				        	// Materialize.toast("Please Set Passcode ",5000);
				        	setTimeout(location.reload.bind(location), 5000);
				        }
				         }
				});

			});

		});

	</script>
</head>
<body>

	<nav class="light-blue lighten-1" role="navigation">
		<div class="nav-wrapper container"><a id="logo-container" href="" class="brand-logo">ForDis</a>
			<ul class="right hide-on-med-and-down">
				<li>{{first_name}} {{last_name}}  </li>
                <li><a id="update_password_button" href="">Update Password</a></li>
				<li><a href="logout">Logout</a></li>
			</ul>

            <ul id="nav-mobile" class="side-nav">
				<li>{{first_name}} {{last_name}}</li>
				<li><a href="login">Logout</a></li>
			</ul>
            <a href="#" data-activates="nav-mobile" class="button-collapse"><i class="material-icons">menu</i></a>
            <div id='update_password_dropdown' class='webui-popover-content'>
                <form id="update_password" action="/class/update_account_password" method="post" class="" >
                    <div class="row">
						<div class="input-field ">
							<input id="old_password" name="old_password" type="password" class="validate" required="" placeholder="Current Password">
						</div>
                    </div>
                    <div class="row">
						<div class="input-field ">
							<input id="new_password" name="new_password" type="password" class="validate" required="" placeholder="New Password">
						</div>
					</div>
                    <div class="row">
                        <input type="submit" class="waves-effect waves-light btn" value="Update Password"/>
                    </div>
                </form>
            </div>
		</div>
	</nav>

	<div class="chip" style="margin: 15px;">
		Instructor Role :
	</div>




	<!-- Modal Structure -->
	<div id="modal_join" action="index" class="modal">
		<div class="modal-content">

			<div class="row">
				<h4 class="center-align">Join a class</h4>
				<form class="col s12" id="join_form">
					<!-- {% csrf_token %} -->
					<div class="row">
						<div class="input-field col s6">
							<input id="class_code" name="codein" type="text" class="validate">
							<label >Classcode</label>
						</div>
					</div>
					<div class="row">
						<div class="input-field col s6">
							<input id="pass_code" name="codeout" type="text" class="validate">
							<label >Passcode</label>
						</div>
					</div>
				</form>

					<div class="center-align vertical-align">
						<button class="modal-action modal-close btn waves-effect waves-light" id="join_button" >Join
							<i class="material-icons right">send</i>
						</button>
					</div>
			</div>
		</div>
	</div>


	<!-- Modal Structure -->
	<div id="modal_create" action="index" class="modal">
		<div class="modal-content">

			<div class="row">
				<h4 class="center-align">Create a class</h4>
				<form class="col s12" id="create_form">
					<!-- {% csrf_token %} -->
					<div class="row">
						<div class="input-field col s6">
							<input id="class_name_create" name="classname" type="text" class="validate">
							<label >Course Name</label>
						</div>
					</div>
					<div class="row">
						<div class="input-field col s6">
							<input id="class_code_create" name="classcode" type="text" class="validate">
							<label >Course Code</label>
						</div>
					</div>
					<div class="row">
						<div class="input-field col s6">
							<input id="passing_code_create" name="passingcode" type="text" class="validate">
							<label >Pass Code</label>
						</div>
					</div>
					<div class="row">
						<div class="input-field col s6">
							<select id="select_semester" name="semester">
								<option value="" disabled selected>Choose your option</option>
								<option value="Autumn">Autumn</option>
								<option value="Spring">Spring</option>
								<option value="Summer">Summer</option>
							</select>
							<label>Semester</label>
						</div>
						<div class="input-field col s6">
							<select id="datepicker" name="year">
								<option value="" disabled selected>Choose Year</option>
								<option value="2017">2017</option>
								<option value="2018">2018</option>
								<option value="2019">2019</option>
								<option value="2020">2020</option>
								<option value="2021">2021</option>
							</select>
							<label>Year</label>
						</div>	   
					</div>
					<br>
				<!-- <div class="center-align vertical-align">
					<input type="submit" class="modal-action  green modal-close waves-effect waves-yellow btn-flat" value="Create" >
				</div> -->
				</form>
					<div class="center-align vertical-align">
						<button class="modal-action modal-close btn waves-effect waves-light" id="create_button">Create
							<i class="material-icons right">send</i>
						</button>
					</div>

			</div>
		</div>
	</div>
 
<div class="row" id = 'instructor_class'>

	{% for akh in instructor_class %}

	<div class="col s12 m3">

		<div class="card blue-grey darken-1">
			<a href={{akh.class_id.class_code}}>
				<div class="card-content white-text">
					<span class="card-title">{{akh.class_id.course_code}}</span>
					<p>
						{{akh.class_id.course_name}} 
						<br> {{akh.class_id.semester}} , {{akh.class_id.year}}
					</p>
				</div>
			</a>

			<div class="card-action">
				<span class="black-text">
					{{akh.class_id.class_code}} 
				</span>				
				<a href="{{akh.class_id.class_code}}/settings" style="float: right;">Settings</a>
			</div>
		</div>
	</div>
	{% endfor %}

	<div class="col s12 m3">
		<div class="card-content">
			<a class="btn-floating waves-effect waves-light btn-large red btn modal-trigger" onclick="$('#modal_create').modal('open')"><i class="material-icons">add</i></a>
		</div>
	</div>
</div>


<div class="chip" style="margin: 15px;">
	Student Role :
</div>
<div class="row" id = 'student_class'>

	{% for akh in student_class %}

	<div class="col s12 m3">
		<div class="card blue-grey darken-1">
			<a href={{akh.class_id.class_code}}>
				<div class="card-content white-text">
					<span class="card-title">{{akh.class_id.course_code}}</span>
					<p>
						{{akh.class_id.course_name}}
					</p>
				</div>
			</a>
			<div class="card-action">
				<span class = "black-text" >{{akh.class_id.semester}} , {{akh.class_id.year}} </span>
				<a href="javascript:dropCourse('{{ akh.class_id.class_code }}')" style="float: right; " >Drop Course</a>

			</div>
		</div>
	</div>

	{% endfor %}
	<div class="col s12 m3">
		<div class="card-content">
			<a  class="btn-floating waves-effect waves-light btn-large red btn modal-trigger" onclick="$('#modal_join').modal('open')"><i class="material-icons">add</i></a>
		</div>
	</div>

</div>


</body>
<script>
    $('#update_password_button').webuiPopover({url:'#update_password_dropdown'});

    $("#update_password").submit(function(event){
        event.preventDefault();
        var $form = $( this ),
            url = $form.attr( 'action' );
        $.post(url,
            $("#update_password").serialize(),
            function (data, status) {
                if(status == "success") {
                    data = JSON.parse(data);
                    if(data['status']=="200"){
                        alert("Password Updated!");
                    }else{
                        alert("Unable to update the password!");
                    }
                }else{
                    alert("Nework Error! Try again!");
                }
            }
        );

        document.getElementById("old_password").value = "";
        document.getElementById("new_password").value = "";
    });

    function dropCourse(class_code) {
        $.post('/class/stud_drop_course',
            {
                'class_code': class_code
            },
            function (data, status) {
                if(status == "success"){
                    data = JSON.parse(data);
                    if(data['status'] == "200"){
                        alert('Class is dropped!');
                        location.reload();
                    }else{
                        alert('You are unable to drop this course!');
                    }
                }else{
                    alert('Network Error! Try Again!');
                }
            }
        );
    }
</script>
</html>
